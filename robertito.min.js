!function(){"use strict";const e=t=>{if(t&&t.__esProxy)return t;if(t instanceof Element||t instanceof Node||"function"==typeof t)return t;const r=new Map,s=e=>{r.has(e)&&r.get(e).forEach(e=>e())},a=(e,t)=>{r.has(e)||r.set(e,new Set),r.get(e).add(t)},o=Array.isArray(t);return new Proxy(t,{get(t,r){if("__observar"===r)return a;if("__disparar"===r)return s;if("__esProxy"===r)return!0;if("__raw"===r)return t;const n=t[r];if(o){return["push","pop","shift","unshift","splice","sort","reverse"].includes(r)?function(...e){const a=Array.prototype[r].apply(t,e);return s("length"),s(r),a}:n}return null===n||"object"!=typeof n||n.__esProxy||n instanceof Element||n instanceof Node||"function"==typeof n?n:(t[r]=e(n),t[r])},set(t,r,a){const o=t[r];return null===a||"object"!=typeof a||a.__esProxy||Array.isArray(a)||a instanceof Element||a instanceof Node||"function"==typeof a||(a=e(a)),t[r]=a,o!==a&&s(r),!0}})};let t=new Set,r=!1;const s=e=>{t.add(e),r||(r=!0,Promise.resolve().then(()=>{const e=Array.from(t);t.clear(),r=!1,e.forEach(e=>{try{e()}catch(e){console.error("Error en actualización encolada:",e)}})}))},a=(e,t,r={})=>{try{return new Function("$datos","$elemento","$siguienteCiclo",`with($datos) { return ${t} }`)(r,e,n)}catch(e){return void(e instanceof TypeError&&(e.message.includes("Cannot read properties of null")||e.message.includes("Cannot read properties of undefined"))||console.error(`Error evaluando: ${t}`,e))}},o=(e,t,r={})=>{try{return new Function("$datos","$elemento","$siguienteCiclo",`with($datos) { ${t} }`)(r,e,n)}catch(e){console.error(`Error evaluando sentencia: ${t}`,e)}},n=e=>new Promise(t=>{s(()=>{e&&e(),t()})}),i=new WeakMap;class c{constructor(e,t){this.elemento=e,this.alcance=t,this.limpiezas=[],this.observadores=new Set}procesarDatos(t){let r;if(r=""===t.trim()?{}:a(this.elemento,t,this.alcance),"object"==typeof r&&null!==r)r.__esProxy?this.alcance=r:this.alcance=e(r),this.alcance.$siguienteCiclo||(this.alcance.$siguienteCiclo=n),this.alcance.$elemento||(this.alcance.$elemento=this.elemento),this.elemento._r_alcanceDatos=this.alcance;else if(void 0===r&&this.alcance)return this.alcance;return this.alcance}procesarInicio(e){const t=o(this.elemento,e,this.alcance);return t&&"function"==typeof t.then?(t.then(()=>{s(()=>{const e=t=>{i.delete(t),Array.from(t.children).forEach(t=>e(t))};Array.from(this.elemento.children).forEach(t=>{e(t),l(t,this.alcance)})})}).catch(e=>{console.error("Error en r-inicio asíncrono:",e)}),t):null}procesarEfecto(e){const t=()=>{o(this.elemento,e,this.alcance)};s(t),this.alcance&&this.alcance.__observar&&Object.keys(this.alcance).forEach(e=>{e.startsWith("__")||e.startsWith("_r_")||(this.alcance.__observar(e,t),this.observadores.add(()=>{}))})}procesarMostrar(e){const t=()=>{const t=a(this.elemento,e,this.alcance);this.elemento.style.display=t?"":"none"};t(),this.alcance&&this.alcance.__observar&&this.observarExpresion(e,t)}procesarTexto(e){const t=()=>{const t=a(this.elemento,e,this.alcance);this.elemento.textContent=t??""};t(),this.alcance&&this.alcance.__observar&&this.observarExpresion(e,t)}procesarModelo(e){const t=()=>{const t=a(this.elemento,e,this.alcance);"checkbox"===this.elemento.type?this.elemento.checked=!!t:"radio"===this.elemento.type?this.elemento.checked=this.elemento.value===t:this.elemento.value=t??""};t();const r=t=>{let r;r="checkbox"===this.elemento.type?this.elemento.checked:"number"===this.elemento.type?this.elemento.valueAsNumber:this.elemento.value,this.establecerValorPorRuta(this.alcance,e,r)};this.elemento.addEventListener("input",r),this.limpiezas.push(()=>this.elemento.removeEventListener("input",r)),this.alcance&&this.alcance.__observar&&this.observarExpresion(e,t)}establecerValorPorRuta(e,t,r){const s=t.split(".");let a=e;for(let e=0;e<s.length-1;e++)a[s[e]]||(a[s[e]]={}),a=a[s[e]];a[s[s.length-1]]=r}procesarEnlace(e,t){const r=()=>{const r=a(this.elemento,t,this.alcance);"class"===e?"string"==typeof r?this.elemento.className=r:"object"==typeof r&&Object.keys(r).forEach(e=>{r[e]?this.elemento.classList.add(e):this.elemento.classList.remove(e)}):"style"===e?"string"==typeof r?this.elemento.setAttribute("style",r):"object"==typeof r&&Object.assign(this.elemento.style,r):"disabled"===e||"checked"===e||"selected"===e?r?(this.elemento.setAttribute(e,""),"disabled"===e&&(this.elemento.disabled=!0),"checked"===e&&(this.elemento.checked=!0),"selected"===e&&(this.elemento.selected=!0)):(this.elemento.removeAttribute(e),"disabled"===e&&(this.elemento.disabled=!1),"checked"===e&&(this.elemento.checked=!1),"selected"===e&&(this.elemento.selected=!1)):null==r||!1===r?this.elemento.removeAttribute(e):this.elemento.setAttribute(e,r)};r(),this.alcance&&this.alcance.__observar&&this.observarExpresion(t,r)}procesarEvento(e,t,r=[]){const s=e=>{r.includes("enter")&&"Enter"!==e.key||r.includes("escape")&&"Escape"!==e.key||r.includes("space")&&" "!==e.key||r.includes("tab")&&"Tab"!==e.key||(r.includes("prevenir")&&e.preventDefault(),r.includes("detener")&&e.stopPropagation(),o(this.elemento,t,this.alcance))};this.elemento.addEventListener(e,s),this.limpiezas.push(()=>this.elemento.removeEventListener(e,s))}procesarPara(e,t){const r=t.match(/^(.+?)\s+en\s+(.+)$/);if(!r)return void console.error("Expresión r-para inválida:",t);let s=r[1].trim(),o=null;const n=r[2].trim();if(s.startsWith("(")&&s.endsWith(")")){const e=s.slice(1,-1).split(",").map(e=>e.trim());s=e[0],o=e[1]||"indice"}const i=e.parentElement,c=document.createComment("r-para");i.insertBefore(c,e),e.remove();let h=[];const u=()=>{const t=a(e,n,this.alcance);if(m(),h.forEach(e=>{e.elemento&&e.elemento.parentNode&&e.elemento.remove()}),h=[],Array.isArray(t)){for(let r=0;r<t.length;r++){const a=t[r],n=e.content.cloneNode(!0).firstElementChild;if(n){const e=Object.create(this.alcance);Object.defineProperty(e,s,{value:a,writable:!0,enumerable:!0,configurable:!0});const t=o||"indice";Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0}),l(n,e),i.insertBefore(n,c),h.push({elemento:n,alcance:e})}}setTimeout(()=>d(),10)}else d()};u(),this.alcance&&this.alcance.__observar&&!e._r_paraObservadorConfigurado&&(e._r_paraObservadorConfigurado=!0,this.observarExpresion(n,u))}observarExpresion(e,t){if(!this.alcance||!this.alcance.__observar)return;const r=e.match(/[a-zA-Z_$][a-zA-Z0-9_$]*/g)||[];[...new Set(r)].forEach(e=>{const r=e.split(".")[0];if(void 0!==this.alcance[r]&&!r.startsWith("$")&&!r.startsWith("_")){this.alcance.__observar(r,t);const e=this.alcance[r];Array.isArray(e)&&e.__observar&&(e.__observar("length",t),e.__observar("unshift",t),e.__observar("push",t),e.__observar("pop",t),e.__observar("shift",t),e.__observar("splice",t)),this.observadores.add(t)}})}limpiar(){this.limpiezas.forEach(e=>e()),this.limpiezas=[],this.observadores.clear()}}const l=(e,t=null)=>{if(!e||1!==e.nodeType)return;if(i.has(e))return void("TEMPLATE"===e.tagName&&e.hasAttribute("r-para"));i.set(e,!0);const r=new c(e,t);let s=t;if(!s&&e.parentElement){let t=e.parentElement;for(;t&&!s;)s=t._r_alcanceDatos,t=t.parentElement}r.alcance=s;let a=!1;if(e.hasAttribute("r-datos")){const t=e.getAttribute("r-datos");if(s=r.procesarDatos(t),r.alcance=s,e.hasAttribute("r-inicio")){a=!0;const t=r.procesarInicio(e.getAttribute("r-inicio"));if(t&&"function"==typeof t.then)return}}else e.hasAttribute("r-inicio")&&(a=!0,r.procesarInicio(e.getAttribute("r-inicio")));if("TEMPLATE"===e.tagName&&e.hasAttribute("r-para")){const t=e.getAttribute("r-para");return void(e._r_paraProcesado||(e._r_paraProcesado=!0,r.procesarPara(e,t)))}e.hasAttribute("r-efecto")&&r.procesarEfecto(e.getAttribute("r-efecto")),e.hasAttribute("r-mostrar")&&r.procesarMostrar(e.getAttribute("r-mostrar")),e.hasAttribute("r-texto")&&r.procesarTexto(e.getAttribute("r-texto")),e.hasAttribute("r-modelo")&&r.procesarModelo(e.getAttribute("r-modelo")),Array.from(e.attributes).forEach(e=>{if(e.name.startsWith("r-enlace:")){const t=e.name.substring(9);r.procesarEnlace(t,e.value)}else if(e.name.startsWith(":")&&":clave"!==e.name){const t=e.name.substring(1);r.procesarEnlace(t,e.value)}}),Array.from(e.attributes).forEach(e=>{if(e.name.startsWith("r-evento:")){const t=e.name.substring(9).split("."),s=t[0],a=t.slice(1);r.procesarEvento(s,e.value,a)}else if(e.name.startsWith("@")){const t=e.name.substring(1).split("."),s=t[0],a=t.slice(1);r.procesarEvento(s,e.value,a)}}),Array.from(e.children).forEach(e=>{l(e,s)})};let h=null,u=!1;const m=()=>{u=!0},d=()=>{u=!1},p=(e,t)=>{e&&1===e.nodeType&&(t(e),Array.from(e.children).forEach(e=>{p(e,t)}))},b=()=>{document.querySelectorAll("[r-datos]").forEach(e=>{l(e)}),h||(h=new MutationObserver(e=>{u||e.forEach(e=>{e.addedNodes.forEach(e=>{1===e.nodeType&&p(e,e=>{e.hasAttribute&&(e.hasAttribute("r-datos")||e.hasAttribute("r-inicio")||e.hasAttribute("r-mostrar")||e.hasAttribute("r-texto")||e.hasAttribute("r-modelo")||e.hasAttribute("r-para")||Array.from(e.attributes).some(e=>e.name.startsWith("r-")||e.name.startsWith(":")||e.name.startsWith("@")))&&l(e)})})})}),h.observe(document.body,{childList:!0,subtree:!0,attributes:!1}))};window.Robertito={iniciar:b,version:"1.0.0",procesarElemento:l},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",b):b()}();